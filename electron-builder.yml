appId: com.whisperflow.app
productName: WhisperFlow
directories:
  buildResources: build
  output: dist

files:
  - '!**/.vscode/*'
  - '!src/*'
  - '!electron.vite.config.ts'
  # FIX IS HERE: Use literal folder name 'build' instead of variable
  - '!build/*' 
  # Exclude raw resources (we add them via extraResources)
  - '!resources/*'

# Unpack native modules so the OS can read the C++ binary files
asarUnpack:
  - "node_modules/uiohook-napi"
  - "node_modules/simple-uiohook"

# Bundle our local binaries (Ollama, Whisper)
extraResources:
  - from: resources
    to: .
    filter:
      - "**/*"

mac:
  target: dmg
  icon: build/icon.icns 
  # MacOS permissions prompts
  identity: null
  extendInfo:
    NSMicrophoneUsageDescription: "WhisperFlow needs microphone access to transcribe your speech."
    NSAccessibilityUsageDescription: "WhisperFlow needs accessibility access to detect your Push-to-Talk keypress and paste text."
  hardenedRuntime: true
  gatekeeperAssess: false

dmg:
  artifactName: ${name}-${version}.${ext}
  contents:
    - x: 130
      y: 220
    - x: 410
      y: 220
      type: link
      path: /Applications